{% extends 'base.html' %}

{% block content %}

    <div class="container">
        <div class="row">
            <p><a href="{% url 'url_workboard_treasury' %}">Retour au workboard trésoriers</a></p>
        </div>
        <div class="row">
            <form action= "{% url 'url_list_user_complete' %}" method="post">
                {% csrf_token %}

                <div class="fieldWrapper">
                    {{ form.order_by.errors }}
                    {{ form.order_by.label }} : {{ form.order_by }}
                </div>
                <div class="fieldWrapper">
                    {{ form.all.errors }}
                    {{ form.all.label }} : {{ form.all }}
                </div>

                <div id="list_year">
                    {% for f in form %}
                        {% if f != form.order_by and f != form.all %}
                            <span class="fieldWrapper">
                                {{ f.errors }}
                                {{ f.label }} : {{ f }}
                            </span>
                        {% endif %}
                    {% endfor %}
                </div>

                <p><input type="submit" value="Lister"/></p>
            </form>
        </div>
        <div class="row">
            <table>
                <tr>
                    <th>Nom</th>
                    <th>Prénom</th>
                    <th>Bucque</th>
                    <th>Num's</th>
                    <th>Tabagn's</th>
                    <th>Prom's</th>
                    <th>Solde</th>
                    <th>Détail</th>
                </tr>
                {% for e in query_user %}
                    <tr>
                        <td>{{ e.last_name }}</td>
                        <td>{{ e.first_name }}</td>
                        <td>{{ e.surname }}</td>
                        <td>{{ e.family }}</td>
                        <td>{{ e.campus }}</td>
                        <td>{{ e.year_pg }}</td>
                        <td>{{ e.balance }}</td>
                        <td><a href="{% url 'url_retrieve_user' pk=e.pk %}">Détail</a></td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <script>
        list_year_fields = document.getElementById("list_year").getElementsByTagName("span");
        bouton_plus = document.createElement("input");
        bouton_plus.setAttribute("type", "button");
        bouton_plus.setAttribute("value", "afficher plus");
        affichage_plus = false;

        // Si plus de 5 promos, on ajoute un bouton "plus" qui affiche le reste
        if (list_year_fields.length > 5) {
            insertAfter(bouton_plus, list_year_fields[5]);
        }

        // Masquage de tous les éléments supérieurs à 5
        afficher_span(list_year_fields, 4, 'None');

        // Affichage du reste des éléments
        bouton_plus.addEventListener("click", function() {
            if (affichage_plus == true) {
                afficher_span(list_year_fields, 4, 'None');
                affichage_plus = false;
                bouton_plus.value = "Afficher plus";
            }
            else {
                afficher_span(list_year_fields, 4, '');
                affichage_plus = true;
                bouton_plus.value = "Afficher moins";
            }
        }, false);

        function afficher_span(liste, debut, afficher) {
            for (i=0; i<liste.length; i++) {
                if (i>debut) {
                    liste[i].style.display = afficher;
                }
            }
        }
        function insertAfter(newElement, afterElement) {
            var parent = afterElement.parentNode;
            if (parent.lastChild === afterElement) { // Si le dernier élément est le même que l'élément après lequel on veut insérer, il suffit de faire appendChild()
                parent.appendChild(newElement);
            } else { // Dans le cas contraire, on fait un insertBefore() sur l'élément suivant
                parent.insertBefore(newElement, afterElement.nextSibling);
            }
        }
    </script>
{% endblock %}