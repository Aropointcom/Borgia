{% extends 'base_sober.html' %}
{% load finances_extra %}

{% block content %}
<div class="panel panel-default">
  <div class="panel-heading">
    Détails de l'utilisateur
    {% if perms.users.change_user %}
        <div class="btn-group" role="group" aria-label="change user">
            <a class="btn btn-primary" href="{% url 'url_user_update' group_name=group_name pk=object.pk %}">Modifier les informations</a>
            <a class="btn btn-primary" href="{% url 'url_user_deactivate' group_name=group_name pk=object.pk %}">
                {% if object.is_active == True %}
                  Désactiver l'utilisateur
                {% else %}
                  Activer l'utilisateur
                {% endif %}</a>
            <a class="btn btn-primary" href="{% url 'url_user_exceptionnalmovement_create' group_name=group_name user_pk=object.pk %}">Mouvement exceptionnel</a>
            <a class="btn btn-primary" href="{% url 'url_user_supplymoney' group_name=group_name user_pk=object.pk %}">Ajout d'argent</a>
        </div>
    {% endif %}
  </div>
  <div class="panel-body">
    <div class="col-md-6">
        {% include "users/retrieve_module.html" %}
    </div>
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    Comptes en banque   <a class="btn btn-primary" href="{% url 'url_user_bankaccount_create' group_name=group_name user_pk=object.pk %}">Ajouter</a>
  </div>
  <table class="table table-default table-striped table-hover">
    <thead>
      <tr>
        <th>Banque</th>
        <th>Compte</th>
        <th>Modifier</th>
        <th>Supprimer</th>
      </tr>
    </thead>
    <tbody>
      {% for account in object.list_bank_account %}
      <tr>
        <td>{{ account.bank }}</td>
        <td>{{ account.account }}</td>
        <td><a
        href="{% url 'url_user_bankaccount_update' group_name=group_name user_pk=object.pk pk=account.pk %}">Modifier
        </a></td>
        <td><a
        href="{% url 'url_user_bankaccount_delete' group_name=group_name user_pk=object.pk pk=account.pk %}">Supprimer
        </a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    Dernières transactions
  </div>
  <table class="table table-default table-striped table-hover">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Montant</th>
        <th>Détail</th>
      </tr>
    </thead>
    <tbody>
      {% for transaction in object.list_sale %}
      {% price_for sale=transaction user=object as price_for %}
      <tr class="{% if price_for > 0 %}success{% else %}danger{% endif %}">
        <td>{{ transaction.date }}</td>
        <td>
          {% if transaction.category == 'transfert' %}
          {{ transaction.justification }}
          {% else %}
          {{ transaction.wording }}
          {% endif %}
        </td>
        <td>{{ price_for }}</td>
        <td><a href="
          {% if transaction.category == 'sale' %}
            {% url 'url_sale_retrieve' group_name=group_name pk=transaction.pk %}
          {% elif transaction.category == 'recharging' %}
            {% url 'url_recharging_retrieve' group_name=group_name pk=transaction.pk %}
          {% elif transaction.category == 'transfert' %}
            {% url 'url_transfert_retrieve' group_name=group_name pk=transaction.pk %}
          {% elif transaction.category == 'exceptionnal_movement' %}
            {% url 'url_exceptionnalmovement_retrieve' group_name=group_name pk=transaction.pk %}
          {% endif %}
          ">Détail</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
