{% extends 'base_sober.html' %}
{% load bootstrap %}
{% load finances_extra %}
{% load i18n %}

{% block content %}
    <div class="panel panel-primary">
        <div class="panel-heading">
          Recherche de transactions
        </div>
        <div class="panel-body">
          <form action="" method="post" class="form-horizontal">
            {% csrf_token %}
            {{ form|bootstrap_horizontal }}
            <div class="form-group">
              <div class="col-sm-10 col-sm-offset-2">
                <button type="submit" class="btn btn-primary">Recherche</button>
                <a class="btn btn-warning" href="">Remise à zéro</a>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          Résultats
        </div>
        <table class="table table-default table-striped table-hover">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Objets</th>
              <th>Montant</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in transaction_list %}
            {% price_for sale=transaction user=user as price_for %}
            <tr class="{% if price_for > 0 %}success{% else %}danger{% endif %}">
              <td>{{ transaction.date|date:"d/m/Y H:i:s" }}</td>
              <td>
                {% if transaction.category == 'transfert' %}
                  Transfert {% if transaction.sender == user %}vers {{ transaction.recipient }}{% else %}de {{ transaction.sender}}{% endif %}
                {% elif transaction.category == 'exceptionnal_movement' %}
                  Mouvement exceptionnel
                {% elif transaction.category == 'recharging' %}
                  Rechargement
                {% elif transaction.category == 'sale' %}
                  {{ transaction.wording }}
                {% elif transaction.category == 'shared_event' %}
                  Evènement
                {% else %}
                  {{ transaction.wording }}
                {% endif %}
              </td>
              <td>
                {% if transaction.category == 'transfert' %}
                  {{ transaction.justification }}
                {% elif transaction.category == 'exceptionnal_movement' %}
                  {{ transaction.justification }}
                {% elif transaction.category == 'recharging' %}
                  {% if transaction.wording == 'Rechargement automatique' %}
                  Avec Lydia
                  {% else %}
                  En manuel
                  {% endif %}
                {% elif transaction.category == 'sale' %}
                  {{ transaction.string_products }}
                {% elif transaction.category == 'shared_event' %}
                  {{ transaction.wording }}
                {% else %}
                  {{ transaction.wording }}
                {% endif %}
              </td>
              <td>{{ price_for }}€</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
{% endblock %}
