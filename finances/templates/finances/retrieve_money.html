{% extends 'base.html' %}
{% load extra %}

{% block content %}

    <div class="container">
        <div class="row">
            <form action= "{% url 'url_treasury_retrieve_money' %}" method="post">
                {% csrf_token %}
                <input type=hidden name="order_by" value="{{ order_by }}" />
                <input type=hidden name="date_begin" value="{{ date_begin }}" />
                <input type=hidden name="date_end" value="{{ date_end }}" />
                <input type=hidden name="operators" value="{{ operators }}" />
                <div class="fieldWrapper">
                    {{ form.date_begin.errors }}
                    {{ form.date_end.errors }}
                    <label for="{{ form.date_begin.id_for_label }}">De : </label> {{ form.date_begin }} <label for="{{ form.date_end.id_for_label }}"> à : </label> {{ form.date_end }}
                </div>
                <div class="fieldWrapper">
                    {{ form.all.errors }}
                    {{ form.all.label }} : {{ form.all }}
                </div>
                <div id="list_operators">
                    {% for f in form %}
                        {% if f != form.date_begin and f != form.date_end and f != form.all %}
                            <span class="fieldWrapper">
                                {{ f.errors }}
                                {{ f.label }} : {{ f }}
                            </span>
                        {% endif %}
                    {% endfor %}
                </div>

                <p><input type="submit" value="Submit"/></p>
            </form>
        </div>
    </div>
    <div class="row">
        <table>
            <tr>
                <th><a href="{% url 'url_treasury_retrieve_money' %}?order_by={{ 'date'|order_by:request }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ page.number }}">Date</a></th>
                <th><a href="{% url 'url_treasury_retrieve_money' %}?order_by={{ 'operator'|order_by:request }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ page.number }}">Opérateur</a></th>
                <th><a href="{% url 'url_treasury_retrieve_money' %}?order_by={{ 'sender'|order_by:request }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ page.number }}">Emetteur</a></th>
                <th>Argent</th>
            </tr>
            {% for e in page %}
                <tr>
                    <td>{{ e.date }}</td>
                    <td>{{ e.operator }}</td>
                    <td>{{ e.sender }}</td>
                    <td>
                        {% for ca in e.payment.list_cash.0 %}
                            Espèces {{ ca }}
                        {% endfor %}
                        {% for ch in e.payment.list_cheque.0 %}
                            Cheque {{ ch }}
                        {% endfor %}
                        {% for l in e.payment.list_lydia.0 %}
                            Lydia {{ l }}
                        {% endfor %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    {% if page.has_other_pages %}
   </div>
        <nav class="pagination">
            <ul class="pagination">
                {% comment %}Affiche un lien vers la première page{% endcomment %}
                <li>
                      <a href="?order_by={{ order_by }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page=first">
                        <span><<</span>
                      </a>
                  </li>
            {% comment %}Affiche un lien vers la page précédente{% endcomment %}
              {% if page.has_previous %}
                  <li>
                    <a href="?order_by={{ order_by }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ page.previous_page_number }}">
                        <span>Previous</span>
                    </a>
                  </li>
              {% else %}
                  <li class="disabled">
                    <a href="#">
                        <span>Previous</span>
                    </a>
                  </li>
              {% endif %}

            {% comment %}Affiche un des liens vers les pages encadrant la page courante{% endcomment %}
              {% for p in page_links %}
                  <li {% if p == page.number %}class="active"{% endif %}>
                      <a href="?order_by={{ order_by }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ p }}">{{ p }}</a>
                  </li>
              {% endfor %}
                {% comment %}Affiche un lien vers la page suivante{% endcomment %}
              {% if page.has_next %}
                  <li>
                      <a href="?order_by={{ order_by }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page={{ page.next_page_number }}">
                        <span>Next</span>
                      </a>
                  </li>
              {% else %}
                  <li {% if not page.has_next %}class="disabled"{% endif %}>
                      <a href="#">
                          <span>Next</span>
                      </a>
                  </li>
              {% endif %}
                {% comment %}Affiche un lien vers la dernière page{% endcomment %}
                <li>
                      <a href="?order_by={{ order_by }}&operators={{ operators }}&date_begin={{ date_begin }}&date_end={{ date_end }}&page=last">
                        <span>>></span>
                      </a>
                </li>
            </ul>
        </nav>
    {% endif %}
    <script>
        // init
        if($('#id_all').is(':checked'))
            $('#list_operators').hide();
        else
            $('#list_operators').show();
        // change
        $('#id_all').change(function() {
            if($(this).is(':checked'))
                $('#list_operators').hide();
            else
                $('#list_operators').show();
        });
    </script>
{% endblock %}